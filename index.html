<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web GIS</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      rel="stylesheet"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />
</head>

<body>
    <nav>
        <ul>
            <li class="logo"><a href="#home" class="page-scroll">GIS<br><hr><span>satukan peta</span></a></li>
        </ul>
        <ul class="menu">
            <li><a class="page-scroll" href="#home">Home</a></li>
            <li><a class="page-scroll" href="#about">Deskripsi</a></li>
            <li><a class="page-scroll" href="#team">Team</a></li>
            <li><a class="page-scroll" href="#project">Project</a></li>
        </ul>
    </nav>
    <header id="home">
        <div id="particles-js">
            <div class="judul">
                <div>
                    <h1>Sebaran<br></h1>
                    <h1><b>Puskesmas di Kota Bogor</b></h1>
                    <p>Kelompok 6</p>
                </div>
            </div>

        </div>
    </header>
    <section class="about" id="about">
        <div class="deskripsi">
            <h2>Puskesmas</h2>
            <p>Pusat Kesehatan Masyarakat, disingkat Puskesmas, adalah fasilitas pelayanan kesehatan yang menyelenggarakan upaya kesehatan masyarakat dan upaya kesehatan perseorangan tingkat pertama, dengan lebih mengutamakan upaya promotif dan preventif,
                untuk mencapai derajat kesehatan masyarakat yang setinggi-tingginya. Upaya kesehatan tersebut diselenggarakan dengan menitikberatkan kepada pelayanan untuk masyarakat luas guna mencapai derajat kesehatan yang optimal, tanpa mengabaikan
                mutu pelayanan kepada perorangan</p>
        </div>
        <div class="gambar">
            <div class="kiri">
                <img src="assets/img/Puskesmas1.jpg" alt="" class="satu">
                <img src="assets/img/Puskesmas.jpg" alt="" class="dua">
            </div>
            <div class="kanan">
                <img src="assets/img/DINKES.jpg" alt="" class="tiga">
            </div>
        </div>
    </section>
    <section class="team" id="team">
        <h2>Our Amazing Team</h2>
        <p class="desc">Faris raja ardana - 065120125.<br/> Muhammad Ihsan Rahman - 065120147. <br/> Saparudin - 065120148</p>
        <div class="gallery">
            <div class="kiri">
                <img src="assets/img/sapar.jpg" alt="" class="thumb">
				<img src="assets/img/ihsan.jpg" alt="" class="thumb">
				<img src="assets/img/faris.jpg" alt="" class="thumb">
            </div>
        </div>
    </section>
    <section class="project" id="project">
        <h2>Sebaran PUSKESMAS Kota Bogor</h2>
            <div class="container py-4">
              </header>
        
              <div id="map" style="height: 600px"></div>
              <div class="m-2">
                <table
                  class="table table-striped table-striped table-bordered"
                  id="sensor"
                >
                  <thead>
                    <tr align="center">
                        <th>Lokasi</th>
                        <th>Suhu</th>
                        <th>Kelembaban</th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                        <th>Terakhir diperbaharui</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
        
            <script
              src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
              integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
              crossorigin="anonymous"
            ></script>
            <script
              src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
              integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
              crossorigin="anonymous"
            ></script>
            <script
              src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
              integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
              crossorigin=""
            ></script>
            <script type="module">
              import { initializeApp } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";
              import {
                getDatabase,
                ref,
                set,
                onValue,
              } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-database.js";
        
              // Your web app's Firebase configuration
              const firebaseConfig = {
                apiKey: "AIzaSyA6tIDmWY3mpxPUFHYEBcsVJSGnaeuR69Y",
                authDomain: "gis2022-fcb1b.firebaseapp.com",
                databaseURL: "https://gis2022-fcb1b-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "gis2022-fcb1b",
                storageBucket: "gis2022-fcb1b.appspot.com",
                messagingSenderId: "274772566217",
                appId: "1:274772566217:web:bb7d82041383a6febb6d18",
                measurementId: "G-G2RNJYN2FE"
                };
                        
              // Initialize Firebase
              const app = initializeApp(firebaseConfig);
        
              // create map
              const map = L.map("map").setView([-6.6061381, 106.801851], 12);
        
              // create basemap
              const basemap = L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
                  attribution:
                    '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                }
              );
        
              basemap.addTo(map);
        
              // add bogor polygon
              const bogorGeojson = await fetch(
                "https://raw.githubusercontent.com/MAROON-LABKOM/script-praktikum/master/sistem-informasi-geografis/bogor.geojson"
              );
              const geojsonBody = await bogorGeojson.json();
              L.geoJson(geojsonBody).addTo(map);
        
             // Get a reference to the database service
      const db = getDatabase(app);
      const sensorRef = ref(db, "WEBGIS");

      // add marker from realtime iot devices
      function addToMap(data) {
        L.marker([data.latitude ?? 0, data.longitude ?? 0])
          .addTo(map)
          .bindPopup(
            `<b>${data.nama} - ${data.kelas}</b><br>Suhu: ${data.suhu}<br>Kelembaban: ${data.kelembaban}<br>Terakhir Diperbaharui:<br>${data.diperbaharui}`
            );
      }

      function addToTable(data) {
        const findRow = document.querySelector(`tr[nama="${data.nama}"]`);
        const row = findRow ?? document.createElement("tr");
        row.setAttribute("nama", data.nama);
        row.innerHTML = `
                <td align="center" >${data.nama}</td>
                <td align="center" >${data.suhu}</td>
                <td align="center" >${data.kelembaban}</td>
                <td align="center" >${data.latitude}</td>
                <td align="center" >${data.longitude}</td>
                <td align="center" >${data.diperbaharui}</td>
            `;
                if (!findRow) {
                  const table = document.getElementById("sensor");
                  const tbody = table.querySelector("tbody");
                  tbody.appendChild(row);
                }
              }
        
              onValue(sensorRef, (snapshot) => {
                if (!snapshot.exists()) return;
                snapshot.forEach(function (data) {
                  const val = data.val();
                  addToMap(val);
                  addToTable(val);
                });
              });
            
            </script>
    </section>
    <script src="assets/js/script.js"></script>
    <script src="assets/js/particles.js"></script>
    <script src="assets/js/app.js"></script>
</body>
</html>